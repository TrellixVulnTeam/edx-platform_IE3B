// Generated by CoffeeScript 1.6.1
(function() {

  describe("XBlock", function() {
    beforeEach(function() {
      return setFixtures("<div>\n  <div class='xblock' id='vA' data-runtime-version=\"A\" data-runtime-class=\"TestRuntime\" data-init=\"initFnA\" data-name=\"a-name\"/>\n  <div>\n    <div class='xblock' id='vZ' data-runtime-version=\"Z\" data-runtime-class=\"TestRuntime\" data-init=\"initFnZ\"/>\n  </div>\n  <div class='xblock' id='missing-version' data-init='initFnA' data-name='no-version'/>\n  <div class='xblock' id='missing-init' data-runtime-version=\"A\" data-name='no-init'/>\n</div>");
    });
    describe("initializeBlock", function() {
      beforeEach(function() {
        window.TestRuntime = {};
        this.runtimeA = {
          name: 'runtimeA'
        };
        this.runtimeZ = {
          name: 'runtimeZ'
        };
        TestRuntime.vA = jasmine.createSpy().andReturn(this.runtimeA);
        TestRuntime.vZ = jasmine.createSpy().andReturn(this.runtimeZ);
        window.initFnA = jasmine.createSpy();
        window.initFnZ = jasmine.createSpy();
        this.fakeChildren = ['list', 'of', 'children'];
        spyOn(XBlock, 'initializeBlocks').andReturn(this.fakeChildren);
        this.vABlock = XBlock.initializeBlock($('#vA')[0]);
        this.vZBlock = XBlock.initializeBlock($('#vZ')[0]);
        this.missingVersionBlock = XBlock.initializeBlock($('#missing-version')[0]);
        return this.missingInitBlock = XBlock.initializeBlock($('#missing-init')[0]);
      });
      it("loads the right runtime version", function() {
        expect(TestRuntime.vA).toHaveBeenCalledWith();
        return expect(TestRuntime.vZ).toHaveBeenCalledWith();
      });
      it("loads the right init function", function() {
        expect(window.initFnA).toHaveBeenCalledWith(this.runtimeA, $('#vA')[0]);
        return expect(window.initFnZ).toHaveBeenCalledWith(this.runtimeZ, $('#vZ')[0]);
      });
      it("loads when missing versions", function() {
        expect(this.missingVersionBlock.element).toBe($('#missing-version'));
        return expect(this.missingVersionBlock.name).toBe('no-version');
      });
      it("loads when missing init fn", function() {
        expect(this.missingInitBlock.element).toBe($('#missing-init'));
        return expect(this.missingInitBlock.name).toBe('no-init');
      });
      it("adds names to blocks", function() {
        return expect(this.vABlock.name).toBe('a-name');
      });
      it("leaves leaves missing names undefined", function() {
        return expect(this.vZBlock.name).toBeUndefined();
      });
      return it("attaches the element to the block", function() {
        expect(this.vABlock.element).toBe($('#vA')[0]);
        expect(this.vZBlock.element).toBe($('#vZ')[0]);
        expect(this.missingVersionBlock.element).toBe($('#missing-version')[0]);
        return expect(this.missingInitBlock.element).toBe($('#missing-init')[0]);
      });
    });
    return describe("initializeBlocks", function() {
      return it("initializes children", function() {
        spyOn(XBlock, 'initializeBlock');
        XBlock.initializeBlocks($('#jasmine-fixtures'));
        expect(XBlock.initializeBlock).toHaveBeenCalledWith($('#vA')[0]);
        return expect(XBlock.initializeBlock).toHaveBeenCalledWith($('#vZ')[0]);
      });
    });
  });

}).call(this);
